<!DOCTYPE html>
<html lang="cn" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>WarmUp | 博客</title>
<meta name="keywords" content="">
<meta name="description" content="https://github.com/xiaotaonan/xiaotaonan.github.io/">
<meta name="author" content="XiaotaoNAN">
<link rel="canonical" href="https://xiaotaonan.github.io/cn/cncategories/warmup/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5ff2630c4d1b3e25bc21f0ecd96681dbcf58219e741fa627857820b5485cb770.css" integrity="sha256-X/JjDE0bPiW8IfDs2WaB289YIZ50H6YnhXggtUhct3A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://xiaotaonan.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://xiaotaonan.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://xiaotaonan.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://xiaotaonan.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://xiaotaonan.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="https://xiaotaonan.github.io/cn/cncategories/warmup/index.xml">
<link rel="alternate" hreflang="cn" href="https://xiaotaonan.github.io/cn/cncategories/warmup/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="WarmUp" />
<meta property="og:description" content="https://github.com/xiaotaonan/xiaotaonan.github.io/" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://xiaotaonan.github.io/cn/cncategories/warmup/" /><meta property="og:image" content="https://xiaotaonan.github.io/images/papermod-cover.png"/>

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://xiaotaonan.github.io/images/papermod-cover.png"/>

<meta name="twitter:title" content="WarmUp"/>
<meta name="twitter:description" content="https://github.com/xiaotaonan/xiaotaonan.github.io/"/>

</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://xiaotaonan.github.io/cn/" accesskey="h" title="博客 (Alt + H)">博客</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://xiaotaonan.github.io/" title="English"
                            aria-label="English">English</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://xiaotaonan.github.io/cn/archives/" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="https://xiaotaonan.github.io/cn/search/" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="https://xiaotaonan.github.io/cn/cntags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://xiaotaonan.github.io/cn/cncategories/" title="目录">
                    <span>目录</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/xiaotaonan/xiaotaonan.github.io/wiki" title="更多">
                    <span>更多</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="https://xiaotaonan.github.io/cn/">Home</a>&nbsp;»&nbsp;<a href="https://xiaotaonan.github.io/cn/cncategories/">Cncategories</a></div>
  <h1>
    WarmUp
    <a href="/cn/cncategories/warmup/index.xml" title="RSS" aria-label="RSS">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round" height="23">
        <path d="M4 11a9 9 0 0 1 9 9" />
        <path d="M4 4a16 16 0 0 1 16 16" />
        <circle cx="5" cy="19" r="1" />
      </svg>
    </a>
  </h1>
</header>

<article class="post-entry tag-entry"> 
<figure class="entry-cover"><img loading="lazy" src="https://xiaotaonan.github.io/images/cn/jitwarmup/0.png" alt="Java应用生命周期-JVM视角">
</figure>
  <header class="entry-header">
    <h2 class="entry-hint-parent">JIT启动预热
    </h2>
  </header>
  <div class="entry-content">
    <p>0.前言 0.1.Java程序执行过程 0.2.编译的快与慢 0.2.1.Java虚拟机（解释的（Interpreted）相对慢） 0.2.2.即时编译器（Just In Time Compiler）（相对快） 0.2.3.Java编译器（Java Compiler）（相对快） Eg: Graal编译器（既可以作为AOT编译器，又可以在JIT编译器中替换C2）、AOT（jaotc）
1.JIT编译过程 Java应用启动后，在完成类加载、字节码验证后，并不会马上触发JIT编译器进行编译，而是先由即时解释器进行解释和分析； 即时解释器在完成了初步的解释和分析后，JIT编译器会利用已经收集到的分析信息来查找热点（经常执行的代码部分），有了热点代码后，C1就可以对这些热点代码进行分析，基于分析的结果编译生成相对高效的目标机器代码，从而使得此时的Java虚拟机具有本机的代码性能，于此同时C1也会进行进一步的分析； C1在完成了进一步的分析后，C2就会利用C1产生的分析信息，进行更积极、更耗时的优化，此时C2会重新编译代码，以生成更高效的目标机器代码，从而更明显的提升Java虚拟机的代码性能。 综上所述，基于热点的更多信息，C1 性能提升更快，而 C2 性能提升更好。 2.当前需求 Azul可以在模拟环境下预热（模拟出热点方法和循环体），然后将结果注入生产环境，直接使用 C2 编译，减少运行时的编译时间。这对于证券行业报盘等场景很有效，因为这些场景一开始就需要高速运转。
横轴：JVM虚拟机达到最佳代码性能的时间； 纵轴：JVM最佳代码性能程度或比率； 毛刺：去优化和垃圾回收导致的。 3.问题 Azul可以在模拟环境中学习和训练，然后将训练结果集作为参考输入到生产环境中，以达到启动时的峰值效果。 并消除 GC毛刺。
3.1.当前问题 启动时间长； 需要很长时间Java虚拟机才可以达到Java虚拟机的最佳代码性能。 3.2.期望结果 启动时间短； 启动后Java虚拟机可快速达到最佳代码性能。 3.3.期望目标 在保证关键功能正确使用的前提下，显著降低再次启动耗时； 消除毛刺，使得Java虚拟机快速达到最佳代码性能。 4.问题分析 4.1.现在加速启动的方案有哪些？ 4.1.1.CDS（Class Data Sharing,类数据共享） 功能定位： 将内部类、应用类、动态（自定义类加载器加载的类和省去dump classlist步骤）等表示转储到文件中（类加载器、jsa文件）； 在每个 JVM 启动时共享 (CDS)。
不足： 没有优化或热点检测； 仅减少类加载时间； 启动速度加快不明显。
4.1.2.AOT（Ahead Of Time Compilation，提前编译，源码到机器码） 优点： 从一开始就“全速”，GraalVM 原生镜像可以做到这一点; 根据定义，AOT 是静态的，代码在运行之前进行编译，运行时编译代码没有开销； 内存占用小
不足： 不解释字节码； 没有热点分析； 没有代码的运行时编译，所以没有运行时字节码生成； 方法内联的有限使用； 反射是可能的，但很复杂； 无法使用推测性优化 （假设条件成立，如数组边界） 必须针对共同特征（如同名同参数等）进行编译 由于优化不彻底，所以总体性能通常会较低； 部署环境！=开发环境。...</p>
  </div>
  <footer class="entry-footer"><span title='2024-01-23 00:00:00 +0000 UTC'>January 23, 2024</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;南小焘</footer>
  <a class="entry-link" aria-label="post link to JIT启动预热" href="https://xiaotaonan.github.io/cn/posts/jit-warmstartup/"></a>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://xiaotaonan.github.io/cn/">博客</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
