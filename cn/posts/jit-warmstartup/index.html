<!DOCTYPE html>
<html lang="cn" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>JIT启动预热 | 博客</title>
<meta name="keywords" content="JIT, CRaC, AOT, WarmUp, Graal">
<meta name="description" content="主要介绍CRaC的适用应用场景以及相对于传统CDS、AOT、JIT相关启动加速方案的优势。">
<meta name="author" content="南小焘">
<link rel="canonical" href="https://xiaotaonan.github.io/cn/posts/jit-warmstartup/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5ff2630c4d1b3e25bc21f0ecd96681dbcf58219e741fa627857820b5485cb770.css" integrity="sha256-X/JjDE0bPiW8IfDs2WaB289YIZ50H6YnhXggtUhct3A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://xiaotaonan.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://xiaotaonan.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://xiaotaonan.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://xiaotaonan.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://xiaotaonan.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://xiaotaonan.github.io/posts/jit-warmstartup/">
<link rel="alternate" hreflang="cn" href="https://xiaotaonan.github.io/cn/posts/jit-warmstartup/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="JIT启动预热" />
<meta property="og:description" content="主要介绍CRaC的适用应用场景以及相对于传统CDS、AOT、JIT相关启动加速方案的优势。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xiaotaonan.github.io/cn/posts/jit-warmstartup/" />
<meta property="og:image" content="https://xiaotaonan.github.io/images/msg.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-23T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-01-23T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://xiaotaonan.github.io/images/msg.png" />
<meta name="twitter:title" content="JIT启动预热"/>
<meta name="twitter:description" content="主要介绍CRaC的适用应用场景以及相对于传统CDS、AOT、JIT相关启动加速方案的优势。"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://xiaotaonan.github.io/cn/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "JIT启动预热",
      "item": "https://xiaotaonan.github.io/cn/posts/jit-warmstartup/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "JIT启动预热",
  "name": "JIT启动预热",
  "description": "主要介绍CRaC的适用应用场景以及相对于传统CDS、AOT、JIT相关启动加速方案的优势。",
  "keywords": [
    "JIT", "CRaC", "AOT", "WarmUp", "Graal"
  ],
  "articleBody": "0.前言 0.1.Java程序执行过程 0.2.编译的快与慢 0.2.1.Java虚拟机（解释的（Interpreted）相对慢） 0.2.2.即时编译器（Just In Time Compiler）（相对快） 0.2.3.Java编译器（Java Compiler）（相对快） Eg: Graal编译器（既可以作为AOT编译器，又可以在JIT编译器中替换C2）、AOT（jaotc）\n1.JIT编译过程 Java应用启动后，在完成类加载、字节码验证后，并不会马上触发JIT编译器进行编译，而是先由即时解释器进行解释和分析； 即时解释器在完成了初步的解释和分析后，JIT编译器会利用已经收集到的分析信息来查找热点（经常执行的代码部分），有了热点代码后，C1就可以对这些热点代码进行分析，基于分析的结果编译生成相对高效的目标机器代码，从而使得此时的Java虚拟机具有本机的代码性能，于此同时C1也会进行进一步的分析； C1在完成了进一步的分析后，C2就会利用C1产生的分析信息，进行更积极、更耗时的优化，此时C2会重新编译代码，以生成更高效的目标机器代码，从而更明显的提升Java虚拟机的代码性能。 综上所述，基于热点的更多信息，C1 性能提升更快，而 C2 性能提升更好。 2.当前需求 Azul可以在模拟环境下预热（模拟出热点方法和循环体），然后将结果注入生产环境，直接使用 C2 编译，减少运行时的编译时间。这对于证券行业报盘等场景很有效，因为这些场景一开始就需要高速运转。\n横轴：JVM虚拟机达到最佳代码性能的时间； 纵轴：JVM最佳代码性能程度或比率； 毛刺：去优化和垃圾回收导致的。 3.问题 Azul可以在模拟环境中学习和训练，然后将训练结果集作为参考输入到生产环境中，以达到启动时的峰值效果。 并消除 GC毛刺。\n3.1.当前问题 启动时间长； 需要很长时间Java虚拟机才可以达到Java虚拟机的最佳代码性能。 3.2.期望结果 启动时间短； 启动后Java虚拟机可快速达到最佳代码性能。 3.3.期望目标 在保证关键功能正确使用的前提下，显著降低再次启动耗时； 消除毛刺，使得Java虚拟机快速达到最佳代码性能。 4.问题分析 4.1.现在加速启动的方案有哪些？ 4.1.1.CDS（Class Data Sharing,类数据共享） 功能定位： 将内部类、应用类、动态（自定义类加载器加载的类和省去dump classlist步骤）等表示转储到文件中（类加载器、jsa文件）； 在每个 JVM 启动时共享 (CDS)。\n不足： 没有优化或热点检测； 仅减少类加载时间； 启动速度加快不明显。\n4.1.2.AOT（Ahead Of Time Compilation，提前编译，源码到机器码） 优点： 从一开始就“全速”，GraalVM 原生镜像可以做到这一点; 根据定义，AOT 是静态的，代码在运行之前进行编译，运行时编译代码没有开销； 内存占用小\n不足： 不解释字节码； 没有热点分析； 没有代码的运行时编译，所以没有运行时字节码生成； 方法内联的有限使用； 反射是可能的，但很复杂； 无法使用推测性优化 （假设条件成立，如数组边界） 必须针对共同特征（如同名同参数等）进行编译 由于优化不彻底，所以总体性能通常会较低； 部署环境！=开发环境。\n4.1.3.JIT（Just In Time Compilation,即时编译） 优点： 可以在运行时使用激进的方法内联（如方法行数不超过80行，激进指大方法，编译时间长，产生大的二进制文件） 可以使用运行时字节码生成 反射很简单 可以使用推测性优化?（假设条件成立，如数组边界） 甚至可以针对 Haswell、Skylake、Ice Lake 等进行优化。（CPU架构） 总体性能通常会更高 部署环境 == 开发环境\n不足： 需要更多时间来启动（但会更快） 在运行时编译代码有开销 更大的内存占用\n4.2.为什么会产生毛刺（毛刺的存在直接影响Java虚拟机达到最佳性能）？ 4.2.1.存在去优化 尽管 C2 编译的代码经过高度优化且寿命较长，但它也可能会被取消优化。结果，JVM 将暂时回滚到解释状态。 当编译器的乐观假设被证明是错误的时，就会发生去优化 - 例如，当配置文件信息与方法行为不匹配时，一旦热路径发生变化，JVM 就会取消优化已编译和内联的代码。\n4.2.2.达到最佳性能前有GC操作 5.解决方案 5.1.(商用收费)Azul Prime ReadyNow 5.1.1.什么是Azul Prime ReadyNow? ReadyNow 是 Azul Platform Prime 的一项功能，启用后可显著改善应用程序的预热行为。\n5.1.2.什么是预热? 预热是指Java应用程序达到最佳性能所需的时间。实时（JIT）编译器的任务是通过从应用程序字节码生成优化的编译代码来提供最佳性能。这个过程需要一些时间，因为JIT编译器会根据应用程序的分析来寻找优化机会。\n5.1.3.基本思路 ReadyNow 会保留应用程序运行期间收集的分析信息，以便后续运行不必再次从头开始学习。预热可以改善每个应用程序的运行，直到达到最佳性能。\n5.1.4.使用方法 要启用 ReadyNow，请添加以下命令行选项，其中 通常对于两者来说是相同的： ● -XX:ProfileLogIn= 指示 Azul Platform Prime 使用现有配置文件日志中的信息。 ● -XX:ProfileLogOut= 记录先前的编译和运行中的去优化决策。 运行应用程序将自动生成或更新配置文件日志。此配置文件日志将在应用程序的后续运行时使用，从而改善预热。\n5.1.5.集成开发 闭源\n5.2.(开源免费)CRaC 5.2.1.什么是CRaC? Referenced to CRIU（Checkpoint Restore In Userspace,在用户空间的检查点恢复） CRaC（Coordinated Restore at Checkpoint,检查点协调恢复）项目研究 Java 程序与在执行时对 Java 实例进行检查点（制作镜像、快照）的机制的协调。 从映像恢复可以解决启动和预热时间方面的一些问题。 该项目的主要目标是开发一种新的与机制无关的标准 API，以通知 Java 程序有关检查点和恢复事件的信息。 其他研究活动将包括但不限于与现有检查点/恢复机制的集成以及新机制的开发、对 JVM 和 JDK 的更改以缩小镜像并确保它们是正确的。\n5.2.2.基本思路 向运行在特定（金丝雀）环境（CPU、内存、I/O、操作系统等）下的Java应用进行数据输入（模拟请求），当输入的数据达到饱和状态后（请求的路径覆盖了所有的用例），冻结正在运行的应用，将Java虚拟机达到最佳性能的检查点输出为快照文件进行留存，后续就可以通过先前保存的镜像文件启动应用（理论上可以是不同的物理机器）。\n5.2.3.部署流程 向运行在金丝雀环境的应用发起模拟请求，达到饱和请求后生成快照文件，然后在生产环境通过快照文件进行恢复应用。\n5.2.4.使用方法 要启用 CRaC，请添加以下命令行选项，其中 通常对于两者来说是相同的： ● -XX:CRaCRestoreFrom=cr 指示JDK使用现有配置文件日志中的信息。 ● -XX:CRaCCheckpointTo=cr 记录先前的编译和运行中的去优化决策。\n5.2.5.集成开发 5.2.5.1.获取源码 git clone https://github.com/openjdk/crac.git -b {tag} 5.2.5.2.手动编译 bash configure make images mv build/linux-x86_64-server-release/images/jdk/ . 5.2.5.3.下载兼容后的CRIU CRIU\n5.2.5.3.在JDK中的同一个命名文件上提取并复制criu二进制文件 cp criu-dist/sbin/criu jdk/lib/criu 5.2.5.4.执行授权 sudo chown root:root jdk/lib/criu sudo chmod u+s jdk/lib/criu 6.验证 6.1.官方验证 6.1.1.验证环境 笔记本电脑（Intel i7-5500U, 16Gb RAM and SSD.） 操作系统内核（Linux kernel 5.7.4-arch1-1） 操作系统（ubuntu:18.04 based image） 平台: archlinux\n6.1.2.验证场景 6.1.2.1.场景一：Time To First Operation 6.1.2.2.场景二：Time to Complete N operations:sprint-boot(OpenJDK ON/OFF CRaC) 6.1.2.3.场景三：Time to Complete N operations:quarkus(OpenJDK ON/OFF CRaC) 6.1.2.4.场景四：Time to Complete N operations:micronaut(OpenJDK ON/OFF CRaC) 6.2.本地验证 6.2.1.验证环境 笔记本（3.1 GHz Intel Core i5, 4Gb RAM and 50Gb SSD.） 操作系统内核（3.10.0-1160.102.1.el7.x86_64） 操作系统（CentOS:7.9 VM） 平台: x86_64 VM Parameters：除存放和加载镜像日志的参数外，没使用其它参数\n6.2.2.验证场景 6.2.2.1.场景一：Time Of First Operation 6.2.2.2.场景二：Time To Complete 100000 Operations ",
  "wordCount" : "286",
  "inLanguage": "cn",
  "image":"https://xiaotaonan.github.io/images/msg.png","datePublished": "2024-01-23T00:00:00Z",
  "dateModified": "2024-01-23T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "南小焘"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://xiaotaonan.github.io/cn/posts/jit-warmstartup/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "博客",
    "logo": {
      "@type": "ImageObject",
      "url": "https://xiaotaonan.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://xiaotaonan.github.io/cn/" accesskey="h" title="博客 (Alt + H)">博客</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://xiaotaonan.github.io/" title="English"
                            aria-label="English">English</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://xiaotaonan.github.io/cn/archives/" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="https://xiaotaonan.github.io/cn/search/" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="https://xiaotaonan.github.io/cn/cntags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://xiaotaonan.github.io/cn/cncategories/" title="目录">
                    <span>目录</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/xiaotaonan/xiaotaonan.github.io/wiki" title="更多">
                    <span>更多</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://xiaotaonan.github.io/cn/">Home</a>&nbsp;»&nbsp;<a href="https://xiaotaonan.github.io/cn/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      JIT启动预热
    </h1>
    <div class="post-description">
      主要介绍CRaC的适用应用场景以及相对于传统CDS、AOT、JIT相关启动加速方案的优势。
    </div>
    <div class="post-meta"><span title='2024-01-23 00:00:00 +0000 UTC'>January 23, 2024</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;南小焘&nbsp;|&nbsp;Translations:
<ul class="i18n_list">
    <li>
        <a href="https://xiaotaonan.github.io/posts/jit-warmstartup/">English</a>
    </li>
</ul>&nbsp;|&nbsp;<a href="https://github.com/xiaotaonan/xiaotaonan.github.io/tree/exampleSite/content/posts/jit-warmstartup.cn.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> 
<figure class="entry-cover">
        <img loading="eager" srcset="https://xiaotaonan.github.io/images/msg_hu5deb5e6d9e0f2517f781ba2ad78170fc_29736_360x0_resize_box_3.png 360w ,https://xiaotaonan.github.io/images/msg_hu5deb5e6d9e0f2517f781ba2ad78170fc_29736_480x0_resize_box_3.png 480w ,https://xiaotaonan.github.io/images/msg_hu5deb5e6d9e0f2517f781ba2ad78170fc_29736_720x0_resize_box_3.png 720w ,https://xiaotaonan.github.io/images/msg_hu5deb5e6d9e0f2517f781ba2ad78170fc_29736_1080x0_resize_box_3.png 1080w ,https://xiaotaonan.github.io/images/msg_hu5deb5e6d9e0f2517f781ba2ad78170fc_29736_1500x0_resize_box_3.png 1500w ,https://xiaotaonan.github.io/images/msg.png 1600w" 
            sizes="(min-width: 768px) 720px, 100vw" src="https://xiaotaonan.github.io/images/msg.png" alt="Generated using [OG Image Playground by Vercel](https://og-playground.vercel.app/)" 
            width="1600" height="800">
        <p>Generated using <a href="https://og-playground.vercel.app/">OG Image Playground by Vercel</a></p>
</figure><div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#0%e5%89%8d%e8%a8%80" aria-label="0.前言">0.前言</a><ul>
                        
                <li>
                    <a href="#01java%e7%a8%8b%e5%ba%8f%e6%89%a7%e8%a1%8c%e8%bf%87%e7%a8%8b" aria-label="0.1.Java程序执行过程">0.1.Java程序执行过程</a></li>
                <li>
                    <a href="#02%e7%bc%96%e8%af%91%e7%9a%84%e5%bf%ab%e4%b8%8e%e6%85%a2" aria-label="0.2.编译的快与慢">0.2.编译的快与慢</a><ul>
                        
                <li>
                    <a href="#021java%e8%99%9a%e6%8b%9f%e6%9c%ba%e8%a7%a3%e9%87%8a%e7%9a%84interpreted%e7%9b%b8%e5%af%b9%e6%85%a2" aria-label="0.2.1.Java虚拟机（解释的（Interpreted）相对慢）">0.2.1.Java虚拟机（解释的（Interpreted）相对慢）</a></li>
                <li>
                    <a href="#022%e5%8d%b3%e6%97%b6%e7%bc%96%e8%af%91%e5%99%a8just-in-time-compiler%e7%9b%b8%e5%af%b9%e5%bf%ab" aria-label="0.2.2.即时编译器（Just In Time Compiler）（相对快）">0.2.2.即时编译器（Just In Time Compiler）（相对快）</a></li>
                <li>
                    <a href="#023java%e7%bc%96%e8%af%91%e5%99%a8java-compiler%e7%9b%b8%e5%af%b9%e5%bf%ab" aria-label="0.2.3.Java编译器（Java Compiler）（相对快）">0.2.3.Java编译器（Java Compiler）（相对快）</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#1jit%e7%bc%96%e8%af%91%e8%bf%87%e7%a8%8b" aria-label="1.JIT编译过程">1.JIT编译过程</a></li>
                <li>
                    <a href="#2%e5%bd%93%e5%89%8d%e9%9c%80%e6%b1%82" aria-label="2.当前需求">2.当前需求</a></li>
                <li>
                    <a href="#3%e9%97%ae%e9%a2%98" aria-label="3.问题">3.问题</a><ul>
                        
                <li>
                    <a href="#31%e5%bd%93%e5%89%8d%e9%97%ae%e9%a2%98" aria-label="3.1.当前问题">3.1.当前问题</a></li>
                <li>
                    <a href="#32%e6%9c%9f%e6%9c%9b%e7%bb%93%e6%9e%9c" aria-label="3.2.期望结果">3.2.期望结果</a></li>
                <li>
                    <a href="#33%e6%9c%9f%e6%9c%9b%e7%9b%ae%e6%a0%87" aria-label="3.3.期望目标">3.3.期望目标</a></li></ul>
                </li>
                <li>
                    <a href="#4%e9%97%ae%e9%a2%98%e5%88%86%e6%9e%90" aria-label="4.问题分析">4.问题分析</a><ul>
                        
                <li>
                    <a href="#41%e7%8e%b0%e5%9c%a8%e5%8a%a0%e9%80%9f%e5%90%af%e5%8a%a8%e7%9a%84%e6%96%b9%e6%a1%88%e6%9c%89%e5%93%aa%e4%ba%9b" aria-label="4.1.现在加速启动的方案有哪些？">4.1.现在加速启动的方案有哪些？</a><ul>
                        
                <li>
                    <a href="#411cdsclass-data-sharing%e7%b1%bb%e6%95%b0%e6%8d%ae%e5%85%b1%e4%ba%ab" aria-label="4.1.1.CDS（Class Data Sharing,类数据共享）">4.1.1.CDS（Class Data Sharing,类数据共享）</a></li>
                <li>
                    <a href="#412aotahead-of-time-compilation%e6%8f%90%e5%89%8d%e7%bc%96%e8%af%91%e6%ba%90%e7%a0%81%e5%88%b0%e6%9c%ba%e5%99%a8%e7%a0%81" aria-label="4.1.2.AOT（Ahead Of Time Compilation，提前编译，源码到机器码）">4.1.2.AOT（Ahead Of Time Compilation，提前编译，源码到机器码）</a></li>
                <li>
                    <a href="#413jitjust-in-time-compilation%e5%8d%b3%e6%97%b6%e7%bc%96%e8%af%91" aria-label="4.1.3.JIT（Just In Time Compilation,即时编译）">4.1.3.JIT（Just In Time Compilation,即时编译）</a></li></ul>
                </li>
                <li>
                    <a href="#42%e4%b8%ba%e4%bb%80%e4%b9%88%e4%bc%9a%e4%ba%a7%e7%94%9f%e6%af%9b%e5%88%ba%e6%af%9b%e5%88%ba%e7%9a%84%e5%ad%98%e5%9c%a8%e7%9b%b4%e6%8e%a5%e5%bd%b1%e5%93%8djava%e8%99%9a%e6%8b%9f%e6%9c%ba%e8%be%be%e5%88%b0%e6%9c%80%e4%bd%b3%e6%80%a7%e8%83%bd" aria-label="4.2.为什么会产生毛刺（毛刺的存在直接影响Java虚拟机达到最佳性能）？">4.2.为什么会产生毛刺（毛刺的存在直接影响Java虚拟机达到最佳性能）？</a><ul>
                        
                <li>
                    <a href="#421%e5%ad%98%e5%9c%a8%e5%8e%bb%e4%bc%98%e5%8c%96" aria-label="4.2.1.存在去优化">4.2.1.存在去优化</a></li>
                <li>
                    <a href="#422%e8%be%be%e5%88%b0%e6%9c%80%e4%bd%b3%e6%80%a7%e8%83%bd%e5%89%8d%e6%9c%89gc%e6%93%8d%e4%bd%9c" aria-label="4.2.2.达到最佳性能前有GC操作">4.2.2.达到最佳性能前有GC操作</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#5%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88" aria-label="5.解决方案">5.解决方案</a><ul>
                        
                <li>
                    <a href="#51%e5%95%86%e7%94%a8%e6%94%b6%e8%b4%b9azul-prime-readynow" aria-label="5.1.(商用收费)Azul Prime ReadyNow">5.1.(商用收费)Azul Prime ReadyNow</a><ul>
                        
                <li>
                    <a href="#511%e4%bb%80%e4%b9%88%e6%98%afazul-prime-readynow" aria-label="5.1.1.什么是Azul Prime ReadyNow?">5.1.1.什么是Azul Prime ReadyNow?</a></li>
                <li>
                    <a href="#512%e4%bb%80%e4%b9%88%e6%98%af%e9%a2%84%e7%83%ad" aria-label="5.1.2.什么是预热?">5.1.2.什么是预热?</a></li>
                <li>
                    <a href="#513%e5%9f%ba%e6%9c%ac%e6%80%9d%e8%b7%af" aria-label="5.1.3.基本思路">5.1.3.基本思路</a></li>
                <li>
                    <a href="#514%e4%bd%bf%e7%94%a8%e6%96%b9%e6%b3%95" aria-label="5.1.4.使用方法">5.1.4.使用方法</a></li>
                <li>
                    <a href="#515%e9%9b%86%e6%88%90%e5%bc%80%e5%8f%91" aria-label="5.1.5.集成开发">5.1.5.集成开发</a></li></ul>
                </li>
                <li>
                    <a href="#52%e5%bc%80%e6%ba%90%e5%85%8d%e8%b4%b9crac" aria-label="5.2.(开源免费)CRaC">5.2.(开源免费)CRaC</a><ul>
                        
                <li>
                    <a href="#521%e4%bb%80%e4%b9%88%e6%98%afcrac" aria-label="5.2.1.什么是CRaC?">5.2.1.什么是CRaC?</a></li>
                <li>
                    <a href="#522%e5%9f%ba%e6%9c%ac%e6%80%9d%e8%b7%af" aria-label="5.2.2.基本思路">5.2.2.基本思路</a></li>
                <li>
                    <a href="#523%e9%83%a8%e7%bd%b2%e6%b5%81%e7%a8%8b" aria-label="5.2.3.部署流程">5.2.3.部署流程</a></li>
                <li>
                    <a href="#524%e4%bd%bf%e7%94%a8%e6%96%b9%e6%b3%95" aria-label="5.2.4.使用方法">5.2.4.使用方法</a></li>
                <li>
                    <a href="#525%e9%9b%86%e6%88%90%e5%bc%80%e5%8f%91" aria-label="5.2.5.集成开发">5.2.5.集成开发</a><ul>
                        
                <li>
                    <a href="#5251%e8%8e%b7%e5%8f%96%e6%ba%90%e7%a0%81" aria-label="5.2.5.1.获取源码">5.2.5.1.获取源码</a></li>
                <li>
                    <a href="#5252%e6%89%8b%e5%8a%a8%e7%bc%96%e8%af%91" aria-label="5.2.5.2.手动编译">5.2.5.2.手动编译</a></li>
                <li>
                    <a href="#5253%e4%b8%8b%e8%bd%bd%e5%85%bc%e5%ae%b9%e5%90%8e%e7%9a%84criu" aria-label="5.2.5.3.下载兼容后的CRIU">5.2.5.3.下载兼容后的CRIU</a></li>
                <li>
                    <a href="#5253%e5%9c%a8jdk%e4%b8%ad%e7%9a%84%e5%90%8c%e4%b8%80%e4%b8%aa%e5%91%bd%e5%90%8d%e6%96%87%e4%bb%b6%e4%b8%8a%e6%8f%90%e5%8f%96%e5%b9%b6%e5%a4%8d%e5%88%b6criu%e4%ba%8c%e8%bf%9b%e5%88%b6%e6%96%87%e4%bb%b6" aria-label="5.2.5.3.在JDK中的同一个命名文件上提取并复制criu二进制文件">5.2.5.3.在JDK中的同一个命名文件上提取并复制criu二进制文件</a></li>
                <li>
                    <a href="#5254%e6%89%a7%e8%a1%8c%e6%8e%88%e6%9d%83" aria-label="5.2.5.4.执行授权">5.2.5.4.执行授权</a></li></ul>
                </li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#6%e9%aa%8c%e8%af%81" aria-label="6.验证">6.验证</a><ul>
                        
                <li>
                    <a href="#61%e5%ae%98%e6%96%b9%e9%aa%8c%e8%af%81" aria-label="6.1.官方验证">6.1.官方验证</a><ul>
                        
                <li>
                    <a href="#611%e9%aa%8c%e8%af%81%e7%8e%af%e5%a2%83" aria-label="6.1.1.验证环境">6.1.1.验证环境</a></li>
                <li>
                    <a href="#612%e9%aa%8c%e8%af%81%e5%9c%ba%e6%99%af" aria-label="6.1.2.验证场景">6.1.2.验证场景</a><ul>
                        
                <li>
                    <a href="#6121%e5%9c%ba%e6%99%af%e4%b8%80time-to-first-operation" aria-label="6.1.2.1.场景一：Time To First Operation">6.1.2.1.场景一：Time To First Operation</a></li>
                <li>
                    <a href="#6122%e5%9c%ba%e6%99%af%e4%ba%8ctime-to-complete-n-operationssprint-bootopenjdk-onoff-crac" aria-label="6.1.2.2.场景二：Time to Complete N operations:sprint-boot(OpenJDK ON/OFF CRaC)">6.1.2.2.场景二：Time to Complete N operations:sprint-boot(OpenJDK ON/OFF CRaC)</a></li>
                <li>
                    <a href="#6123%e5%9c%ba%e6%99%af%e4%b8%89time-to-complete-n-operationsquarkusopenjdk-onoff-crac" aria-label="6.1.2.3.场景三：Time to Complete N operations:quarkus(OpenJDK ON/OFF CRaC)">6.1.2.3.场景三：Time to Complete N operations:quarkus(OpenJDK ON/OFF CRaC)</a></li>
                <li>
                    <a href="#6124%e5%9c%ba%e6%99%af%e5%9b%9btime-to-complete-n-operationsmicronautopenjdk-onoff-crac" aria-label="6.1.2.4.场景四：Time to Complete N operations:micronaut(OpenJDK ON/OFF CRaC)">6.1.2.4.场景四：Time to Complete N operations:micronaut(OpenJDK ON/OFF CRaC)</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#62%e6%9c%ac%e5%9c%b0%e9%aa%8c%e8%af%81" aria-label="6.2.本地验证">6.2.本地验证</a><ul>
                        
                <li>
                    <a href="#621%e9%aa%8c%e8%af%81%e7%8e%af%e5%a2%83" aria-label="6.2.1.验证环境">6.2.1.验证环境</a></li>
                <li>
                    <a href="#622%e9%aa%8c%e8%af%81%e5%9c%ba%e6%99%af" aria-label="6.2.2.验证场景">6.2.2.验证场景</a><ul>
                        
                <li>
                    <a href="#6221%e5%9c%ba%e6%99%af%e4%b8%80time-of-first-operation" aria-label="6.2.2.1.场景一：Time Of First Operation">6.2.2.1.场景一：Time Of First Operation</a></li>
                <li>
                    <a href="#6222%e5%9c%ba%e6%99%af%e4%ba%8ctime-to-complete-100000-operations" aria-label="6.2.2.2.场景二：Time To Complete 100000 Operations">6.2.2.2.场景二：Time To Complete 100000 Operations</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="0前言">0.前言<a hidden class="anchor" aria-hidden="true" href="#0前言">#</a></h1>
<p><img src="/images/cn/jitwarmup/0.png"/><br></p>
<p><img src="/images/cn/jitwarmup/0-0.png"/><br></p>
<p><img src="/images/cn/jitwarmup/0-1.png"/><br></p>
<p><img src="/images/cn/jitwarmup/0-2.png"/><br></p>
<p><img src="/images/cn/jitwarmup/0-3.png"/><br></p>
<h2 id="01java程序执行过程">0.1.Java程序执行过程<a hidden class="anchor" aria-hidden="true" href="#01java程序执行过程">#</a></h2>
<h2 id="02编译的快与慢">0.2.编译的快与慢<a hidden class="anchor" aria-hidden="true" href="#02编译的快与慢">#</a></h2>
<h3 id="021java虚拟机解释的interpreted相对慢">0.2.1.Java虚拟机（解释的（Interpreted）相对慢）<a hidden class="anchor" aria-hidden="true" href="#021java虚拟机解释的interpreted相对慢">#</a></h3>
<img src="/images/cn/jitwarmup/0-4.png"/>
<h3 id="022即时编译器just-in-time-compiler相对快">0.2.2.即时编译器（Just In Time Compiler）（相对快）<a hidden class="anchor" aria-hidden="true" href="#022即时编译器just-in-time-compiler相对快">#</a></h3>
<img src="/images/cn/jitwarmup/0-5.png"/>
<h3 id="023java编译器java-compiler相对快">0.2.3.Java编译器（Java Compiler）（相对快）<a hidden class="anchor" aria-hidden="true" href="#023java编译器java-compiler相对快">#</a></h3>
<p><img src="/images/cn/jitwarmup/0-6.png"/><br></p>
<p>Eg: Graal编译器（既可以作为AOT编译器，又可以在JIT编译器中替换C2）、AOT（jaotc）</p>
<h1 id="1jit编译过程">1.JIT编译过程<a hidden class="anchor" aria-hidden="true" href="#1jit编译过程">#</a></h1>
<p><img src="/images/cn/jitwarmup/1-0.png"/><br></p>
<ol>
<li>Java应用启动后，在完成类加载、字节码验证后，并不会马上触发JIT编译器进行编译，而是先由即时解释器进行解释和分析；</li>
<li>即时解释器在完成了初步的解释和分析后，JIT编译器会利用已经收集到的分析信息来查找热点（经常执行的代码部分），有了热点代码后，C1就可以对这些热点代码进行分析，基于分析的结果编译生成相对高效的目标机器代码，从而使得此时的Java虚拟机具有本机的代码性能，于此同时C1也会进行进一步的分析；</li>
<li>C1在完成了进一步的分析后，C2就会利用C1产生的分析信息，进行更积极、更耗时的优化，此时C2会重新编译代码，以生成更高效的目标机器代码，从而更明显的提升Java虚拟机的代码性能。</li>
<li>综上所述，基于热点的更多信息，C1 性能提升更快，而 C2 性能提升更好。</li>
</ol>
<h1 id="2当前需求">2.当前需求<a hidden class="anchor" aria-hidden="true" href="#2当前需求">#</a></h1>
<p>Azul可以在模拟环境下预热（模拟出热点方法和循环体），然后将结果注入生产环境，直接使用 C2 编译，减少运行时的编译时间。这对于证券行业报盘等场景很有效，因为这些场景一开始就需要高速运转。</p>
<p><img src="/images/cn/jitwarmup/2-0.png"/><br></p>
<ol>
<li>横轴：JVM虚拟机达到最佳代码性能的时间；</li>
<li>纵轴：JVM最佳代码性能程度或比率；</li>
<li>毛刺：去优化和垃圾回收导致的。</li>
</ol>
<h1 id="3问题">3.问题<a hidden class="anchor" aria-hidden="true" href="#3问题">#</a></h1>
<p>Azul可以在模拟环境中学习和训练，然后将训练结果集作为参考输入到生产环境中，以达到启动时的峰值效果。 并消除 GC毛刺。</p>
<h2 id="31当前问题">3.1.当前问题<a hidden class="anchor" aria-hidden="true" href="#31当前问题">#</a></h2>
<p><img src="/images/cn/jitwarmup/3-1.png"/><br></p>
<ol>
<li>启动时间长；</li>
<li>需要很长时间Java虚拟机才可以达到Java虚拟机的最佳代码性能。</li>
</ol>
<h2 id="32期望结果">3.2.期望结果<a hidden class="anchor" aria-hidden="true" href="#32期望结果">#</a></h2>
<p><img src="/images/cn/jitwarmup/3-2.png"/><br></p>
<ol>
<li>启动时间短；</li>
<li>启动后Java虚拟机可快速达到最佳代码性能。</li>
</ol>
<h2 id="33期望目标">3.3.期望目标<a hidden class="anchor" aria-hidden="true" href="#33期望目标">#</a></h2>
<ol>
<li>在保证关键功能正确使用的前提下，显著降低再次启动耗时；</li>
<li>消除毛刺，使得Java虚拟机快速达到最佳代码性能。</li>
</ol>
<h1 id="4问题分析">4.问题分析<a hidden class="anchor" aria-hidden="true" href="#4问题分析">#</a></h1>
<h2 id="41现在加速启动的方案有哪些">4.1.现在加速启动的方案有哪些？<a hidden class="anchor" aria-hidden="true" href="#41现在加速启动的方案有哪些">#</a></h2>
<h3 id="411cdsclass-data-sharing类数据共享">4.1.1.CDS（Class Data Sharing,类数据共享）<a hidden class="anchor" aria-hidden="true" href="#411cdsclass-data-sharing类数据共享">#</a></h3>
<p><strong>功能定位：</strong>
将内部类、应用类、动态（自定义类加载器加载的类和省去dump classlist步骤）等表示转储到文件中（类加载器、jsa文件）；
在每个 JVM 启动时共享 (CDS)。</p>
<p><strong>不足：</strong>
没有优化或热点检测；
仅减少类加载时间；
启动速度加快不明显。</p>
<h3 id="412aotahead-of-time-compilation提前编译源码到机器码">4.1.2.AOT（Ahead Of Time Compilation，提前编译，源码到机器码）<a hidden class="anchor" aria-hidden="true" href="#412aotahead-of-time-compilation提前编译源码到机器码">#</a></h3>
<p><strong>优点：</strong>
从一开始就“全速”，GraalVM 原生镜像可以做到这一点;
根据定义，AOT 是静态的，代码在运行之前进行编译，运行时编译代码没有开销；
内存占用小</p>
<p><strong>不足：</strong>
不解释字节码；
没有热点分析；
没有代码的运行时编译，所以没有运行时字节码生成；
方法内联的有限使用；
反射是可能的，但很复杂；
无法使用推测性优化 （假设条件成立，如数组边界）
必须针对共同特征（如同名同参数等）进行编译
由于优化不彻底，所以总体性能通常会较低；
部署环境！=开发环境。</p>
<h3 id="413jitjust-in-time-compilation即时编译">4.1.3.JIT（Just In Time Compilation,即时编译）<a hidden class="anchor" aria-hidden="true" href="#413jitjust-in-time-compilation即时编译">#</a></h3>
<p><strong>优点：</strong>
可以在运行时使用激进的方法内联（如方法行数不超过80行，激进指大方法，编译时间长，产生大的二进制文件）
可以使用运行时字节码生成
反射很简单
可以使用推测性优化?（假设条件成立，如数组边界）
甚至可以针对 Haswell、Skylake、Ice Lake 等进行优化。（CPU架构）
总体性能通常会更高
部署环境 == 开发环境</p>
<p><strong>不足：</strong>
需要更多时间来启动（但会更快）
在运行时编译代码有开销
更大的内存占用</p>
<h2 id="42为什么会产生毛刺毛刺的存在直接影响java虚拟机达到最佳性能">4.2.为什么会产生毛刺（毛刺的存在直接影响Java虚拟机达到最佳性能）？<a hidden class="anchor" aria-hidden="true" href="#42为什么会产生毛刺毛刺的存在直接影响java虚拟机达到最佳性能">#</a></h2>
<h3 id="421存在去优化">4.2.1.存在去优化<a hidden class="anchor" aria-hidden="true" href="#421存在去优化">#</a></h3>
<p><img src="/images/cn/jitwarmup/4-1.png"/><br></p>
<p>尽管 C2 编译的代码经过高度优化且寿命较长，但它也可能会被取消优化。结果，JVM 将暂时回滚到解释状态。
当编译器的乐观假设被证明是错误的时，就会发生去优化 - 例如，当配置文件信息与方法行为不匹配时，一旦热路径发生变化，JVM 就会取消优化已编译和内联的代码。</p>
<h3 id="422达到最佳性能前有gc操作">4.2.2.达到最佳性能前有GC操作<a hidden class="anchor" aria-hidden="true" href="#422达到最佳性能前有gc操作">#</a></h3>
<h1 id="5解决方案">5.解决方案<a hidden class="anchor" aria-hidden="true" href="#5解决方案">#</a></h1>
<h2 id="51商用收费azul-prime-readynow">5.1.(商用收费)Azul Prime ReadyNow<a hidden class="anchor" aria-hidden="true" href="#51商用收费azul-prime-readynow">#</a></h2>
<h3 id="511什么是azul-prime-readynow">5.1.1.什么是Azul Prime ReadyNow?<a hidden class="anchor" aria-hidden="true" href="#511什么是azul-prime-readynow">#</a></h3>
<p>ReadyNow 是 Azul Platform Prime 的一项功能，启用后可显著改善应用程序的预热行为。</p>
<p><img src="/images/cn/jitwarmup/5-1.png"/><br></p>
<h3 id="512什么是预热">5.1.2.什么是预热?<a hidden class="anchor" aria-hidden="true" href="#512什么是预热">#</a></h3>
<p>预热是指Java应用程序达到最佳性能所需的时间。实时（JIT）编译器的任务是通过从应用程序字节码生成优化的编译代码来提供最佳性能。这个过程需要一些时间，因为JIT编译器会根据应用程序的分析来寻找优化机会。</p>
<h3 id="513基本思路">5.1.3.基本思路<a hidden class="anchor" aria-hidden="true" href="#513基本思路">#</a></h3>
<p>ReadyNow 会保留应用程序运行期间收集的分析信息，以便后续运行不必再次从头开始学习。预热可以改善每个应用程序的运行，直到达到最佳性能。</p>
<h3 id="514使用方法">5.1.4.使用方法<a hidden class="anchor" aria-hidden="true" href="#514使用方法">#</a></h3>
<p>要启用 ReadyNow，请添加以下命令行选项，其中 通常对于两者来说是相同的：
● -XX:ProfileLogIn= 指示 Azul Platform Prime 使用现有配置文件日志中的信息。
● -XX:ProfileLogOut= 记录先前的编译和运行中的去优化决策。
运行应用程序将自动生成或更新配置文件日志。此配置文件日志将在应用程序的后续运行时使用，从而改善预热。</p>
<h3 id="515集成开发">5.1.5.集成开发<a hidden class="anchor" aria-hidden="true" href="#515集成开发">#</a></h3>
<p>闭源</p>
<h2 id="52开源免费crac">5.2.(开源免费)CRaC<a hidden class="anchor" aria-hidden="true" href="#52开源免费crac">#</a></h2>
<h3 id="521什么是crac">5.2.1.什么是CRaC?<a hidden class="anchor" aria-hidden="true" href="#521什么是crac">#</a></h3>
<p>Referenced to CRIU（Checkpoint Restore In Userspace,在用户空间的检查点恢复）
CRaC（Coordinated Restore at Checkpoint,检查点协调恢复）项目研究 Java 程序与在执行时对 Java 实例进行检查点（制作镜像、快照）的机制的协调。 从映像恢复可以解决启动和预热时间方面的一些问题。 该项目的主要目标是开发一种新的与机制无关的标准 API，以通知 Java 程序有关检查点和恢复事件的信息。 其他研究活动将包括但不限于与现有检查点/恢复机制的集成以及新机制的开发、对 JVM 和 JDK 的更改以缩小镜像并确保它们是正确的。</p>
<h3 id="522基本思路">5.2.2.基本思路<a hidden class="anchor" aria-hidden="true" href="#522基本思路">#</a></h3>
<p><img src="/images/cn/jitwarmup/5-2.png"/><br></p>
<p>向运行在特定（金丝雀）环境（CPU、内存、I/O、操作系统等）下的Java应用进行数据输入（模拟请求），当输入的数据达到饱和状态后（请求的路径覆盖了所有的用例），冻结正在运行的应用，将Java虚拟机达到最佳性能的检查点输出为快照文件进行留存，后续就可以通过先前保存的镜像文件启动应用（理论上可以是不同的物理机器）。</p>
<h3 id="523部署流程">5.2.3.部署流程<a hidden class="anchor" aria-hidden="true" href="#523部署流程">#</a></h3>
<p><img src="/images/cn/jitwarmup/5-3.png"/><br></p>
<p>向运行在金丝雀环境的应用发起模拟请求，达到饱和请求后生成快照文件，然后在生产环境通过快照文件进行恢复应用。</p>
<h3 id="524使用方法">5.2.4.使用方法<a hidden class="anchor" aria-hidden="true" href="#524使用方法">#</a></h3>
<p>要启用 CRaC，请添加以下命令行选项，其中 通常对于两者来说是相同的：
● -XX:CRaCRestoreFrom=cr 指示JDK使用现有配置文件日志中的信息。
● -XX:CRaCCheckpointTo=cr 记录先前的编译和运行中的去优化决策。</p>
<h3 id="525集成开发">5.2.5.集成开发<a hidden class="anchor" aria-hidden="true" href="#525集成开发">#</a></h3>
<h4 id="5251获取源码">5.2.5.1.获取源码<a hidden class="anchor" aria-hidden="true" href="#5251获取源码">#</a></h4>
<pre tabindex="0"><code>git clone https://github.com/openjdk/crac.git -b {tag}
</code></pre><h4 id="5252手动编译">5.2.5.2.手动编译<a hidden class="anchor" aria-hidden="true" href="#5252手动编译">#</a></h4>
<pre tabindex="0"><code>bash configure
make images
mv build/linux-x86_64-server-release/images/jdk/ .
</code></pre><h4 id="5253下载兼容后的criu">5.2.5.3.下载兼容后的CRIU<a hidden class="anchor" aria-hidden="true" href="#5253下载兼容后的criu">#</a></h4>
<p><a href="https://github.com/CRaC/criu/releases/tag/release-1.4">CRIU</a></p>
<h4 id="5253在jdk中的同一个命名文件上提取并复制criu二进制文件">5.2.5.3.在JDK中的同一个命名文件上提取并复制criu二进制文件<a hidden class="anchor" aria-hidden="true" href="#5253在jdk中的同一个命名文件上提取并复制criu二进制文件">#</a></h4>
<pre tabindex="0"><code>cp criu-dist/sbin/criu jdk/lib/criu
</code></pre><h4 id="5254执行授权">5.2.5.4.执行授权<a hidden class="anchor" aria-hidden="true" href="#5254执行授权">#</a></h4>
<pre tabindex="0"><code>sudo chown root:root jdk/lib/criu
sudo chmod u+s jdk/lib/criu
</code></pre><h1 id="6验证">6.验证<a hidden class="anchor" aria-hidden="true" href="#6验证">#</a></h1>
<h2 id="61官方验证">6.1.官方验证<a hidden class="anchor" aria-hidden="true" href="#61官方验证">#</a></h2>
<h3 id="611验证环境">6.1.1.验证环境<a hidden class="anchor" aria-hidden="true" href="#611验证环境">#</a></h3>
<p>笔记本电脑（Intel i7-5500U, 16Gb RAM and SSD.）
操作系统内核（Linux kernel 5.7.4-arch1-1）
操作系统（ubuntu:18.04 based image）
平台: archlinux</p>
<h3 id="612验证场景">6.1.2.验证场景<a hidden class="anchor" aria-hidden="true" href="#612验证场景">#</a></h3>
<h4 id="6121场景一time-to-first-operation">6.1.2.1.场景一：Time To First Operation<a hidden class="anchor" aria-hidden="true" href="#6121场景一time-to-first-operation">#</a></h4>
<p><img src="/images/cn/jitwarmup/6-1.png"/><br></p>
<p><img src="/images/cn/jitwarmup/6-2.png"/><br></p>
<h4 id="6122场景二time-to-complete-n-operationssprint-bootopenjdk-onoff-crac">6.1.2.2.场景二：Time to Complete N operations:sprint-boot(OpenJDK ON/OFF CRaC)<a hidden class="anchor" aria-hidden="true" href="#6122场景二time-to-complete-n-operationssprint-bootopenjdk-onoff-crac">#</a></h4>
<p><img src="/images/cn/jitwarmup/6-3.png"/><br></p>
<h4 id="6123场景三time-to-complete-n-operationsquarkusopenjdk-onoff-crac">6.1.2.3.场景三：Time to Complete N operations:quarkus(OpenJDK ON/OFF CRaC)<a hidden class="anchor" aria-hidden="true" href="#6123场景三time-to-complete-n-operationsquarkusopenjdk-onoff-crac">#</a></h4>
<p><img src="/images/cn/jitwarmup/6-4.png"/><br></p>
<h4 id="6124场景四time-to-complete-n-operationsmicronautopenjdk-onoff-crac">6.1.2.4.场景四：Time to Complete N operations:micronaut(OpenJDK ON/OFF CRaC)<a hidden class="anchor" aria-hidden="true" href="#6124场景四time-to-complete-n-operationsmicronautopenjdk-onoff-crac">#</a></h4>
<p><img src="/images/cn/jitwarmup/6-5.png"/><br></p>
<h2 id="62本地验证">6.2.本地验证<a hidden class="anchor" aria-hidden="true" href="#62本地验证">#</a></h2>
<h3 id="621验证环境">6.2.1.验证环境<a hidden class="anchor" aria-hidden="true" href="#621验证环境">#</a></h3>
<p>笔记本（3.1 GHz Intel Core i5, 4Gb RAM and 50Gb SSD.）
操作系统内核（3.10.0-1160.102.1.el7.x86_64）
操作系统（CentOS:7.9 VM）
平台: x86_64
VM Parameters：除存放和加载镜像日志的参数外，没使用其它参数</p>
<h3 id="622验证场景">6.2.2.验证场景<a hidden class="anchor" aria-hidden="true" href="#622验证场景">#</a></h3>
<h4 id="6221场景一time-of-first-operation">6.2.2.1.场景一：Time Of First Operation<a hidden class="anchor" aria-hidden="true" href="#6221场景一time-of-first-operation">#</a></h4>
<p><img src="/images/cn/jitwarmup/6-6.png"/><br></p>
<p><img src="/images/cn/jitwarmup/6-7.png"/><br></p>
<h4 id="6222场景二time-to-complete-100000-operations">6.2.2.2.场景二：Time To Complete 100000 Operations<a hidden class="anchor" aria-hidden="true" href="#6222场景二time-to-complete-100000-operations">#</a></h4>
<p><img src="/images/cn/jitwarmup/6-8.png"/><br></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share JIT启动预热 on x"
            href="https://x.com/intent/tweet/?text=JIT%e5%90%af%e5%8a%a8%e9%a2%84%e7%83%ad&amp;url=https%3a%2f%2fxiaotaonan.github.io%2fcn%2fposts%2fjit-warmstartup%2f&amp;hashtags=JIT%2cCRaC%2cAOT%2cWarmUp%2cGraal">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share JIT启动预热 on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fxiaotaonan.github.io%2fcn%2fposts%2fjit-warmstartup%2f&amp;title=JIT%e5%90%af%e5%8a%a8%e9%a2%84%e7%83%ad&amp;summary=JIT%e5%90%af%e5%8a%a8%e9%a2%84%e7%83%ad&amp;source=https%3a%2f%2fxiaotaonan.github.io%2fcn%2fposts%2fjit-warmstartup%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share JIT启动预热 on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fxiaotaonan.github.io%2fcn%2fposts%2fjit-warmstartup%2f&title=JIT%e5%90%af%e5%8a%a8%e9%a2%84%e7%83%ad">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share JIT启动预热 on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fxiaotaonan.github.io%2fcn%2fposts%2fjit-warmstartup%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share JIT启动预热 on whatsapp"
            href="https://api.whatsapp.com/send?text=JIT%e5%90%af%e5%8a%a8%e9%a2%84%e7%83%ad%20-%20https%3a%2f%2fxiaotaonan.github.io%2fcn%2fposts%2fjit-warmstartup%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share JIT启动预热 on telegram"
            href="https://telegram.me/share/url?text=JIT%e5%90%af%e5%8a%a8%e9%a2%84%e7%83%ad&amp;url=https%3a%2f%2fxiaotaonan.github.io%2fcn%2fposts%2fjit-warmstartup%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share JIT启动预热 on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=JIT%e5%90%af%e5%8a%a8%e9%a2%84%e7%83%ad&u=https%3a%2f%2fxiaotaonan.github.io%2fcn%2fposts%2fjit-warmstartup%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://xiaotaonan.github.io/cn/">博客</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
